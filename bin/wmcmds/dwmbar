#!/bin/sh

ftodo()
{
	rtodo=$(todo | sed '/^[[:space:]]*$/d' | wc -l | sed 's/0//g')
	[ "${rtodo}" != "" ] && echo "📝 ${rtodo} | "
}

fappointments()
{
	rappointments=$(appointments)
	[ "${rappointments}" != "" ] && echo "📅 ${rappointments} | "
}

fnews()
{
	rnews=$(news)
	[ "${rnews}" != "" ] && echo "📰 ${rnews} | "
}

fpacpackages()
{
	rpac=$(pacpackages)
	[ "${rpac}" != "" ] && echo "📦 ${rpac} | "
}

fweather()
{
	rweather=$(weather)
	[ "${rweather}" != "" ] && echo "${rweather} | "
}

fmailbox()
{
	rbox=$(mailbox)
	[ "${rbox}" != "" ] && echo "📬 ${rbox} | "
}

fbattery()
{
	capacity=$(cat /sys/class/power_supply/"$1"/capacity) || exit
	status=$(cat /sys/class/power_supply/"$1"/status)

	[ "${capacity}" -lt 25 ] && warn="❗" || warn=" "
	printf "%s%s%s" "$(echo "$status" | sed -e "s/,//;s/Discharging/🔋/;s/Not Charging/🛑/;s/Charging/🔌/;s/Unknown/♻️/;s/Full/⚡/;s/ 0*/ /g;s/ :/ /g")" "$warn" "$(echo "$capacity" | sed -e 's/$/%/')"
}

while true; do
	xsetroot -name "$(fappointments)$(ftodo)$(fnews)$(fmailbox)$(fpacpackages)$(fweather)$(volume) | $(internet) | $(fbattery BAT1) | $(fbattery BAT2) | $(clock)"

	sleep 15
done
