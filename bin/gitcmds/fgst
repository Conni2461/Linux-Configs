#!/bin/bash

# scripts
previewScript='tmp=$(echo {} | egrep "^AM" | cut -d" " -f2); [ -z $tmp ] && tmp=$(echo {} | egrep "^\ M" | cut -d" " -f3); [ -z $tmp ] && exit; git diff --color $tmp'

allFiles=$(git status -s)

git rev-parse HEAD > /dev/null || exit
[ "${allFiles}" = "" ] && exit

case $1 in
	-a )	files=$(echo "$allFiles" | egrep -v '^A\ |^M\ ') script=$previewScript ;;
	-c )	files=$(echo "$allFiles" | egrep -v '^A\ |^M\ |\?\?') script=$previewScript ;;
	-u )	files=$(echo "$allFiles" | egrep '^A|^M');;
	*  )	exit 1;;
esac

export FZF_DEFAULT_OPTS="-m --reverse --bind ctrl-k:preview-up,shift-up:preview-up,ctrl-j:preview-down,shift-down:preview-down"

echo "$files" | fzf --preview "${script}" | while read -r item; do
	echo "$item" | awk '{print $2}'
done
