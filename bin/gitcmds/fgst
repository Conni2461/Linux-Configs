#!/bin/bash

# scripts
previewScript='tmp=$(echo {} | egrep "^AM" | cut -d" " -f2); [ -z $tmp ] && tmp=$(echo {} | egrep "^\ M" | cut -d" " -f3); [ -z $tmp ] && exit; git diff $tmp'

allFiles=$(git status -s)

git rev-parse HEAD > /dev/null || exit
[ "${allFiles}" = "" ] && exit

case $1 in
	-a )	files=$(echo "$allFiles" | egrep -v '^A\ |^M\ ') script=$previewScript ;;
	-c )	files=$(echo "$allFiles" | egrep -v '^A\ |^M\ |\?\?') script=$previewScript;;
	-u )	files=$(echo "$allFiles" | egrep '^A|^M');;
	*  )	exit 1;;
esac

echo "$files" | FZF_DEFAULT_OPTS="--reverse" fzf -m --preview "${script}" | while read -r item; do
	echo "$item" | awk '{print $2}'
done
