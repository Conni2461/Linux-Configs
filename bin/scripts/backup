#!/bin/bash

#### Include
source ~/bin/scripts/utils

#### Constants

OPTIONS="-cvpz"
ADDITIONALS=""

FILES="--exclude=.manjaro-tools \
--exclude=/backup.tar.gz \
--exclude=/bin \
--exclude=/boot \
--exclude=/desktopfs-pkgs.txt \
--exclude=/dev \
--exclude=/lib \
--exclude=/lib64 \
--exclude=/lost+found \
--exclude=/media \
--exclude=/mnt \
--exclude=/opt \
--exclude=/proc \
--exclude=/root/.cache \
--exclude=/rootfs-pkgs.txt \
--exclude=/run \
--exclude=/sbin \
--exclude=/srv \
--exclude=/sys \
--exclude=/tmp \
--exclude=/usr \
--exclude=/var/log \
--exclude=/var/cache/apt/archives \
--exclude=/home/*/.cache \
--exclude=/home/*/.local/share/Trash \
--exclude=/home/*/.mail"

function usage()
{
        echo "-f                write to file"
        echo "-s                write via ssh"
}

function version()
{
        echo "Version 0.1"
}

check_priv || exit 1

if [ "$#" == 0 ]; then
        usage
        exit
fi

while [ "$1" != "" ]; do
        case $1 in
                --help )        usage
                                exit
                                ;;
                --version )     version
                                exit
                                ;;
                -f )            OPTIONS="${OPTIONS}f /backup.tar.gz"
                                ;;
                -s )            ADDITIONALS='| ssh pi@pi.apengine.de "( cat > ssh_backup.tar.gz )"'
                                ;;
                * )             err "$1 is not a valid option" || usage
                                exit 1
                                ;;
        esac
        shift
done

tar ${OPTIONS} ${FILES} / ${ADDITIONALS}
