#!/bin/sh

output=$(calcurse -a | sed -n '1!p')

echo "$output" | while IFS= read -r line ; do
	first_char="$(printf '%s' "$line" | cut -c1-2)"
	if [ "$first_char" = " -" ]; then
		if [ "${line}" = "${lastDate}" ]; then
			continue;
		fi

		lastDate="$line"
		echo "$line" | sed -e 's/^ - *//'
	else
		allDay=$(echo "$line" | grep '\*')
		if [ "$allDay" != "" ]; then
			echo "$line" | sed -e 's/^ \* /- /'
		else
			echo "$line" | sed -e 's/^[ \t]/    - /'
		fi
	fi
done
