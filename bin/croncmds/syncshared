#!/bin/bash

ping -q -t 1 -c 1 `ip r | grep -m 1 default | cut -d ' ' -f 3` >/dev/null || exit

notify-send "Sync docs shared folder"

didsync=false

for f in $(ssh home find docs/shared/ -type f); do
        echo ${f}
        local=/home/conni/${f}
        diff <(ssh home cat ${f}) <(cat ${local}) >/dev/null 2>&1
        if [ ! $? -eq 0 ]; then
                didsync=true
                mkdir -pv $(dirname ${local})
                scp home:~/${f} ${local}
                notify-send "Synced ${f}"
        else
                echo "${f} was not copied"
        fi
done

if [ "${didsync}" == "false" ]; then
        notify-send "No files synced"
fi
