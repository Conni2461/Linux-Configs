#!/bin/bash

ping -q -t 1 -c 1 `ip r | grep -m 1 default | cut -d ' ' -f 3` >/dev/null || exit

notify-send "Sync docs shared folder"

DIDSYNC=false

for f in $(ssh home find docs/shared/ -type f); do
	echo ${f}
	LOCAL=/home/conni/${f}
	diff <(ssh home cat ${f}) <(cat ${LOCAL}) >/dev/null 2>&1
	if [ ! $? -eq 0 ]; then
		DIDSYNC=true
		scp home:~/${f} ${LOCAL} >/dev/null 2>&1
		notify-send "Synced $(basename ${f})"
	else
		echo "$(basename ${f}) was not copied"
	fi
done

if [ "$DIDSYNC" == "false" ]; then
	notify-send "No files synced"
fi
