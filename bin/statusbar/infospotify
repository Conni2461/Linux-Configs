#!/bin/bash

source ~/bin/scripts/utils

usage()
{
	echo "Controll Spotify via CLI"
	echo "-v || --version			print Version number"
	echo "-h || --help 			print Help text"
	echo
	echo "-s				print status: playing, paused"
	echo "-p				toggle play pause"
	echo "-n				play next song"
	echo "-b				play previous song"
	echo "-i				print information use -f to format."
	echo
	echo "Default Format: <status> <Artist>: <Title>"
}

version()
{
	echo "Version 0.0.1 Conni2461"
}

stat()
{
	qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlaybackStatus
}

playpause()
{
	qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
}

next()
{
	qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Next
}

previous()
{
	qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Previous
}

printinfo()
{
	artist=$(qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Metadata | grep artist | cut -d: -f3 | awk NF)
	title=$(qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Metadata | grep title | cut -d: -f3 | awk NF)
	status=$(stat)
	glyp=""

	if [ "$status" == "Playing" ]; then
		glyp="▶"
	else
		glyp="⏸"
	fi

	echo "$glyp $artist: $title"
}

# Check if spotify is running
ps -ef | grep "\<spotify\>" | grep -v grep >/dev/null || echo && exit

if [ $# -eq 0 ]; then
	printinfo
	exit
fi

case "$1" in
	-h | --help )
		usage
		exit
		;;
	-v | --version )
		version
		exit
		;;
	-s )
		stat
		exit
		;;
	-p )
		playpause
		exit
		;;
	-n )
		next
		exit
		;;
	-b )
		previous
		exit
		;;
	-i )
		printinfo
		exit
		;;
	* )	err "$1 is not a valid input"
		usage
		exit 1
		;;
esac
